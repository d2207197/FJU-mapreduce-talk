% Name           : nlplab.sty
% Author         : Yen, Tzu-Hsi

%% Modified from
%% Name           : treelab1.sty
%% Author         : Emigdio Z.Flores
%% Version        : 0.1.1
%% Created on     : 11.24.2013
%% Modified	 : 03.20.2014
%% Copyright      : Copyright (c) 2013 by Emigdio Z.Flores
%% License        : This file may be distributed and/or modified under the
%%                  GNU Public License.
%% Description    : Beamer theme for tree-lab group


\ProvidesPackage{beamerthemenlplab}

\usepackage{eso-pic}
\usepackage{etoolbox}
\usepackage{pgfbaseimage}
\usepackage{adjustbox}
\usepackage{xkeyval}



\newif\if@doSans
\@doSansfalse
\DeclareOption{noserifmath}{\@doSanstrue}
\newif\if@doNoFlama
\@doNoFlamafalse
\DeclareOption{noflama}{\@doNoFlamatrue}
\newif\if@doSectionPage
\@doSectionPagefalse
\DeclareOption{nosectionpages}{\@doSectionPagetrue}
\ProcessOptions

\mode<presentation>

%---------------------------------------------------------------------
% TOC
%---------------------------------------------------------------------
%\useoutertheme[subsection=false,shadow]{miniframes}
\useoutertheme[shadow]{miniframes}
% \useoutertheme[shadow]{smoothbars}
\setbeamertemplate{section in toc}[sections numbered]
\setbeamertemplate{subsection in toc}[subsections numbered]

%---------------------------------------------------------------------
% custom commands
%---------------------------------------------------------------------
\newcommand{\rightTextArrow}{→}
\newcommand{\quoted}[1]{›#1‹}
\newcommand{\doublequoted}[1]{»#1«}

% \declareimage{image-name}{image-path}
\newcommand{\declareimage}[2]{\pgfdeclareimage{#1}{#2}}

% \useimage[width=width,height=height,caption=caption]{image-name}
\makeatletter
\newlength{\useimage@width}
\newlength{\useimage@height}
\define@key{useimage}{width}[\textwidth]{\setlength\useimage@width{#1}}
\define@key{useimage}{height}[\textheight]{\setlength\useimage@height{#1}}
\define@key{useimage}{caption}{\def\useimage@caption{#1}}
\newcommand\useimage[2][]{
  \begingroup
  \presetkeys{useimage}{width,height}{}
  \setkeys{useimage}{#1}
  \begin{figure}[ht]
    \centering
    \maxsizebox{\useimage@width}{\useimage@height}{\pgfuseimage{#2}}
    \ifdef{\useimage@caption}{\label{fig:\useimage@caption}\caption{\useimage@caption}}{}
  \end{figure}
  \endgroup
}
\newcommand\includeimage[2][]{
  \begingroup
  \presetkeys{useimage}{width,height}{}
  \setkeys{useimage}{#1}
  \begin{figure}[ht]
    \centering
    \includegraphics[width=\useimage@width,height=\useimage@height,keepaspectratio]{#2}
    \ifdef{\useimage@caption}{\label{fig:\useimage@caption}\caption{\useimage@caption}}{}
  \end{figure}
  \endgroup
}
\makeatother


%---------------------------------------------------------------------
% Itemize
%---------------------------------------------------------------------
% \setbeamertemplate{itemize item}{\rightTextArrow}
% \setbeamertemplate{itemize subitem}{\rightTextArrow}
% \setbeamertemplate{itemize subsubitem}{\rightTextArrow}

\setbeamertemplate{itemize item}{\(\blacksquare\)}
\setbeamertemplate{itemize subitem}{\(\blacksquare{}\)}
\setbeamertemplate{itemize subsubitem}{\(\blacksquare{}\)}


\setbeamertemplate{enumerate item}
{\usebeamerfont*{item projected}%
  \colorbox{treelabWarmBlueDark}{\color{white}\insertenumlabel
  }
  % \hbox{%
  % \usebeamerfont*{item projected}%
  %   % \usebeamercolor[olive!30]{item projected}% original: [bg]
  % \vrule width2.25ex height1.85ex depth.4ex%
  % \hskip-2.25ex%
  % \hbox to2.25ex{%
  % \hfil%
  % \color{white}\insertenumlabel% original: [fg]
  % \hfil}%
  % }%
}

\setlength{\parskip}{0.5em}

%---------------------------------------------------------------------
% Colors
%---------------------------------------------------------------------

% Primary Colors
\definecolor{treelabRed}{rgb}{0.882352941,0,0.098039216}
\definecolor{treelabRedDark}{rgb}{0.588235294,0,0.058823529}
\definecolor{treelabWarmBlueDark}{rgb}{0,0.239,0.392}
\definecolor{treelabWarmGreyDark}{rgb}{0.274509804,0.254901961,0.235294118}
\definecolor{treelabWarmGreyLight}{rgb}{0.8,0.8,0.8}
\definecolor{treelabOrange}{rgb}{0.9294,0.4588,0.16078}
\definecolor{treelabGreen}{rgb}{0.5019,0.549,0.25098}
\definecolor{treelabLightGreen}{rgb}{0.7921,0.8156,0.6666}
\definecolor{treelabPink}{rgb}{0.447,0.1686,0.3019}

% Secondary Colors
\definecolor{treelabSec1}{rgb}{0,0.588235294,0.509803922}
\definecolor{treelabSec1Dark}{rgb}{0,0.392156863,0.31372549}
\definecolor{treelabSec1Comp}{rgb}{0.294117647,0.745098039,0.882352941}
\definecolor{treelabSec1CompDark}{rgb}{0.196078431,0.490196078,0.568627451}

\definecolor{treelabSec2}{rgb}{0.607843137,0.764705882,0.156862745}
\definecolor{treelabSec2Dark}{rgb}{0.411764706,0.490196078,0.098039216}
\definecolor{treelabSec2Comp}{rgb}{0.254901961,0.156862745,0.509803922}
\definecolor{treelabSec2CompDark}{rgb}{0.176470588,0.098039216,0.333333333}

\definecolor{treelabSec3}{rgb}{0.509803922,0.078431373,0.31372549}
\definecolor{treelabSec3Dark}{rgb}{0.338345865,0.058823529,0.196078431}
\definecolor{treelabSec3Comp}{rgb}{1,0.509803922,0}
\definecolor{treelabSec3CompDark}{rgb}{0.666666667,0.333333333,0}

% General
\setbeamercolor{normal text}{fg=treelabWarmGreyDark}
\setbeamercolor{structure}{fg=treelabWarmBlueDark}
\setbeamercolor{alerted text}{fg=treelabWarmBlueDark}
\setbeamercolor{example text}{fg=white}
\setbeamercolor{copyright text}{fg=treelabWarmGreyLight}
\setbeamercolor{palette primary}{fg=treelabWarmBlueDark}
\setbeamercolor{palette secondary}{fg=treelabWarmBlueDark,bg=treelabWarmGreyLight}
\setbeamercolor{palette tertiary}{fg=black,bg=treelabWarmGreyLight}
\setbeamercolor{palette quaternary}{fg=white, bg=treelabWarmBlueDark}
% Titlepage
\setbeamercolor{title}{parent=normal text}
\setbeamercolor{subtitle}{parent=normal text}
\setbeamercolor{institute}{parent=normal text}
% Content
\setbeamercolor{frametitle}{parent=palette quaternary}
\setbeamercolor{framesubtitle}{parent=palette quaternary}
% Blocks
\setbeamercolor{block title}{parent=palette quaternary}
\setbeamercolor{block body}{parent=palette secondary}
\setbeamercolor{block title example}{fg=white, bg=treelabSec1Dark}
\setbeamercolor{block body example}{fg=white, bg=treelabSec1}
\setbeamercolor{block title alerted}{fg=white, bg=treelabGreen}
\setbeamercolor{block body alerted}{fg=black, bg=treelabLightGreen}
% Notes
\setbeamercolor{note page}{fg=treelabWarmGreyDark,bg=treelabWarmGreyLight}
\setbeamercolor{note title}{fg=white, bg=treelabWarmGreyDark}
\setbeamercolor{note date}{parent=note title}
% Page Number
\setbeamercolor{page number in head/foot}{fg=treelabWarmGreyDark}

%---------------------------------------------------------------------
% Fonts
%---------------------------------------------------------------------

% General

% Declare fontfamilys
\if@doNoFlama%
	% Sans serif math option
	\if@doSans%
	% Sans serif math
		\usepackage{fontspec}%
		\setmainfont{Arial Narrow}%
	\else%
		% Serif math
		\usefonttheme{professionalfonts}%
		\usepackage[no-math]{fontspec}%
	\fi%
	
	\newfontfamily\Light{Arial}%
	\newfontfamily\Book{Arial-Bold}%
	\newfontfamily\Medium{Arial-Bold}%
	\setsansfont{Arial}%
\else%
	% Sans serif math option
	\if@doSans%
	% Sans serif math
		\usepackage{fontspec}%
		\setmainfont{Flama}%
	\else%
		% Serif math
		\usefonttheme{professionalfonts}%
		\usepackage[no-math]{fontspec}%
	\fi%
	
	\newfontfamily\Light{Flama}%
	\newfontfamily\Book{FlamaBook}%
	\newfontfamily\Medium{FlamaMedium}%
	\setsansfont{Flama}%
\fi%

\renewcommand\UrlFont{\Medium}
% Titlepage
\setbeamerfont{title}{family=\Light,size=\fontsize{20}{20}}
\setbeamerfont{subtitle}{family=\Light,size=\fontsize{12}{14}}
\setbeamerfont{date}{size=\fontsize{8}{10}}
\setbeamerfont{author}{size=\fontsize{12}{15}}
\setbeamerfont{institute}{size=\fontsize{8}{10}}
% Section
\setbeamerfont{section title}{size=\LARGE}
% Content
\setbeamerfont{frametitle}{family=\Light,size=\large}
\setbeamerfont{copyright text}{family=\Light,size=\tiny}
\setbeamerfont{block title}{family=\Book,size=\large}
\setbeamerfont{block title alerted}{family=\Book,size=\large}
\setbeamerfont{alerted text}{family=\Medium}
% Captions
\setbeamerfont{caption name}{family=\Book}

% new
% \DeclareTextFontCommand{\textmedium}{\Medium}
% \DeclareTextFontCommand{\textbook}{\Book}

% Emphasis \emph{} and \em
% \makeatletter
% \DeclareRobustCommand{\em}{%
%   \@nomath\em \if b\expandafter\@car\f@series\@nil
%   \normalfont \else \bfseries \Book \color{treelabWarmBlueDark} \fi}
% \makeatother


%---------------------------------------------------------------------
% Titlepage
%---------------------------------------------------------------------

% Titlepage structure
\def\maketitle{\ifbeamer@inframe\titlepage\else\frame[plain]{\titlepage}\fi}
\def\titlepage{\usebeamertemplate{title page}}
\setbeamertemplate{title page}
{
	% Add background to title page
  % \begin{minipage}[b][\paperheight]{\textwidth}
% \AddToShipoutPictureFG*{\includegraphics[height=\paperheight]{background1.pdf}}
	\vspace*{0.2\textheight}
	% \includegraphics[height=14mm]{./logo1}\par
        % \vspace*{14mm}
	% \vspace*{5mm}
	\ifx\insertsubtitle\@empty%
	\else%
		{\usebeamerfont{title}\usebeamercolor[fg]{title}\MakeUppercase{\inserttitle}\par}%
	\fi%
	\ifx\insertsubtitle\@empty%
	\else%
		{\usebeamerfont{subtitle}\usebeamercolor[fg]{subtitle}\insertsubtitle\par}%
		\vspace*{5mm}
	\fi%
	\ifx\insertdate\@empty%
	\else%
		{\usebeamerfont{date}\usebeamercolor[fg]{date}\insertdate\par}%
	\fi% 

	\vfill
	
	\ifx\insertauthor\@empty%
	\else%
		{\usebeamerfont{author}\usebeamercolor[fg]{author}\insertauthor\par}%
	\fi%
	\ifx\insertinstitut\@empty%
	\else%
		% \vspace*{.1\textheight}
		{\usebeamerfont{institute}\usebeamercolor[fg]{institute}\insertinstitute\par}%
	\fi% 
		\vspace*{.1\textheight}
	% \vspace*{5mm}
	% \end{minipage}
}

%---------------------------------------------------------------------
% Sectionpages
%---------------------------------------------------------------------

% Make Sectionhead uppercase
\newcommand{\insertsectionHEAD}{%
	\expandafter\insertsectionHEADaux\insertsectionhead}
	\newcommand{\insertsectionHEADaux}[3]{\MakeUppercase{#3}
}

% Make Sectionhead uppercase
\newcommand{\insertsubsectionHEAD}{%
	\expandafter\insertsubsectionHEADaux\insertsubsectionhead}
	\newcommand{\insertsubsectionHEADaux}[3]{\MakeUppercase{#3}
}

\if@doSectionPage\@empty
\else
% Insert frame with section title at every section start
\AtBeginSection[]
{
\begingroup
\setbeamercolor{background canvas}{bg=treelabWarmBlueDark}
\begin{frame}[plain,c]
\centering
\vfill\usebeamerfont{section title}\textcolor{white}{\insertsectionHEAD}\vfill
\end{frame}
\endgroup
}
\AtBeginSubsection[]
{
\begingroup
\setbeamercolor{background canvas}{bg=treelabPink}
\begin{frame}[plain,c]
\centering
\vfill\usebeamerfont{section title}\textcolor{white}{\insertsubsectionHEAD}\vfill
\end{frame}
\endgroup
}
\fi

%---------------------------------------------------------------------
% Frametitle
%---------------------------------------------------------------------
\setbeamertemplate{frametitle}
{
\begin{beamercolorbox}[wd=\paperwidth,leftskip=0.3cm,rightskip=0.3cm,ht=3ex,dp=1.5ex]{frametitle}
	 \usebeamerfont{frametitle}\insertframetitle
	 % \usebeamerfont{framesubtitle}\smallskip\insertframesubtitle
\end{beamercolorbox}
}

%---------------------------------------------------------------------
% Footline
%---------------------------------------------------------------------
\usenavigationsymbolstemplate{}
\setbeamertemplate{footline}
{%
\begin{beamercolorbox}[wd=\textwidth,ht=3ex,dp=1.5ex,leftskip=0.3cm,rightskip=0.3cm]{structure}%
\hfill\usebeamerfont{page number in head/foot}%
\insertframenumber%
\vspace{0.2cm}
\end{beamercolorbox}%
}

%---------------------------------------------------------------------
% Captions
%---------------------------------------------------------------------
\setbeamertemplate{caption label separator}{: }

%---------------------------------------------------------------------
% Blocks
%---------------------------------------------------------------------
\setbeamertemplate{block begin}
{
  \setbeamercolor{item}{parent=block body}
  \par\vskip\medskipamount%
  \begin{beamercolorbox}[sep=.5ex,dp=0.6ex,leftskip=0.5ex,rightskip=0.5ex]{block title}
    \usebeamerfont*{block title}\insertblocktitle%
  \end{beamercolorbox}%
  {\parskip0pt\par}%
  {\nointerlineskip\vskip-0.5pt}%
  \usebeamerfont{block body}%
  \begin{beamercolorbox}[sep=.5ex,dp=0.6ex,leftskip=0.5ex,rightskip=0.5ex,vmode]{block body}%
}
\setbeamertemplate{block end}  
{\end{beamercolorbox}\vskip\smallskipamount}

\setbeamertemplate{block alerted begin}
{
  \setbeamercolor{item}{parent=block body alerted}
  \par\vskip\medskipamount%
  \begin{beamercolorbox}[sep=.5ex,dp=0.6ex,leftskip=0.5ex,rightskip=0.5ex]{block title alerted}
    \usebeamerfont*{block title alerted}\insertblocktitle%
  \end{beamercolorbox}%
  {\parskip0pt\par}%
  {\nointerlineskip\vskip-0.5pt}%
  \usebeamerfont{block body alerted}%
  \begin{beamercolorbox}[sep=.5ex,dp=0.6ex,leftskip=0.5ex,rightskip=0.5ex,vmode]{block body alerted}%
}
\setbeamertemplate{block alerted end}
{\end{beamercolorbox}\vskip\smallskipamount}

\setbeamertemplate{block example begin}
{
  \par\vskip\medskipamount%
  \begin{beamercolorbox}[sep=.5ex,dp=0.6ex,leftskip=0.5ex,rightskip=0.5ex]{block title example}
    \usebeamerfont*{block title example}\insertblocktitle%
  \end{beamercolorbox}%
  {\parskip0pt\par}%
  {\nointerlineskip\vskip-0.5pt}%
  \usebeamerfont{block body example}%
  \begin{beamercolorbox}[sep=.5ex,dp=0.6ex,leftskip=0.5ex,rightskip=0.5ex,vmode]{block body example}%
}
\setbeamertemplate{block example end}
{\end{beamercolorbox}\vskip\smallskipamount}

%---------------------------------------------------------------------
% Images
%---------------------------------------------------------------------

\newbox\mytempbox
\newdimen\mytempdimen

\newcommand\includegraphicscopyright[3][]{%
  \leavevmode\vbox{\vskip3pt\raggedright\setbox\mytempbox=\hbox{\includegraphics[#1]{#2}}%
    \mytempdimen=\wd\mytempbox\box\mytempbox\par\vskip1pt%
    \usebeamerfont{copyright text}{\usebeamercolor[fg]{copyright text}{\vbox{\hsize=\mytempdimen#3}}}\vskip3pt%
}}

\mode
<all>
